4. Learner Credit Usage Data Sourced from Analytics API
============================================================

Status
******

Accepted - July 2022

Context
*******

* Enterprise Admins need a clear and consistent view of how much balance of their Enterprise Offer has been utilized,
  so they wonâ€™t become confused by disagreeing sources.

Decisions
*********

* We'll rely on the Analytics API to provide enrollment-level Offer utilization data.
  **This is a subset of the same data source used for the Learner Progress Report.**
* We'll also rely on the Analytics API to provide aggregate data about total utilization and remaining balance
  for a given Offer.
* Both of these will be displayed in the Learner Credit Management page in the admin portal.
* The LCM page treats the ecommerce ``ConditionalOffer`` model as the source of truth **for only**
  the Offer display name, start date, and end date.

Consequences
************

* We're now bound to the data pipeline for this feature.
* Fresh data only visible to an end-user after a prefect job transfers data from our data warehouse into
  the Analytics API.  This was once/day at time of initial implementation, but has been increased to TODO times/day.
* Pipeline failures mean this data will be stale until failure is resolved.
* This puts us in a weird position where ecommerce is the source of truth about Enterprise Offer metadata,
  *but not* for the amount redeemed or remaining balance for a given Offer.
* Testing is somewhat painful, because there is no data warehouse corresponding to the staging environment.
  We can test locally with synthetic/fake data generated by management commands in the Analytics API repository.

Alternatives Considered
***********************

Sourcing the data directly from ecommerce
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

There's a couple problems with this:

* Enterprise admin users already rely on the Learner Progress Report page to understand how
  their learners are consuming subsidies - either Coupons or (now) Offers.
* The Learner Progress Report data is already considered the source of truth for backoffice purposes.
* The ecommerce service is deprecated.
